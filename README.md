# Jenkins Monitor

The `jenkins-monitor` is a Go-based application designed to monitor Jenkins job performance, analyze historical data, and provide ad-hoc insights into running Jenkins processes. It serves as a robust and portable replacement for the original bash scripts, offering improved maintainability, error handling, and structured logging.

## Features

*   **Process Monitoring:** Continuously monitors Jenkins processes (identified by the `BUILD_URL` environment variable) and records their CPU and memory usage over time.
*   **Performance Analysis:** Analyzes collected CSV data to identify and report the top 5 Jenkins jobs with the highest peak CPU and memory consumption.
*   **Ad-hoc Monitoring:** Provides an immediate snapshot of currently running Jenkins processes, sorted by CPU usage, displaying PID, process name, build path, CPU%, and MEM%.
*   **Structured Logging:** All application logs are generated in a structured JSON format and output to both the console and a dedicated log file (`jenkinsjobmonitor.log`).
*   **Modular Design:** The codebase is organized into a standard Go project structure, enhancing readability, maintainability, and testability.

## Commands

The `jenkins-monitor` application supports three main commands:

*   `monitor`: Starts a continuous monitoring process.
    ```bash
    ./cmd/jenkins-monitor/jenkins-monitor monitor --output /var/lib/jenkins-monitor/processes.csv
    ```
    Use `Ctrl+C` to stop the monitoring process.

*   `analyze`: Analyzes a CSV file generated by the `monitor` command.
    ```bash
    ./cmd/jenkins-monitor/jenkins-monitor analyze --input /var/lib/jenkins-monitor/processes.csv
    ```

*   `adhoc`: Performs an immediate scan of running Jenkins processes.
    ```bash
    ./cmd/jenkins-monitor/jenkins-monitor adhoc
    ```

For more detailed information on each command and its options, use the `-h` flag:
```bash
./cmd/jenkins-monitor/jenkins-monitor <command> -h
```

## Project Structure

The project follows a standard Go project layout:

```
jenkins-monitor/
├── cmd/
│   └── jenkins-monitor/
│       └── main.go             # Main entry point of the application, handles command-line parsing.
├── internal/
│   ├── adhoc/
│   │   └── adhoc.go            # Implements the ad-hoc monitoring logic.
│   ├── analyze/
│   │   └── analyze.go          # Implements the CSV analysis logic.
│   ├── monitor/
│   │   └── monitor.go          # Implements the continuous monitoring logic.
│   ├── process/
│   │   ├── process.go          # Contains logic for identifying and extracting Jenkins process info.
│   │   └── process_test.go     # Unit tests for process-related functions.
│   └── utils/
│       ├── utils.go            # Provides utility functions (logging, float parsing, directory handling).
│       └── utils_test.go       # Unit tests for utility functions.
├── go.mod                      # Go module definition.
├── go.sum                      # Go module checksums.
├── Build.md                    # Instructions for building the application for different architectures.
├── Install-instructions.md     # Instructions for installing and running the application with systemd.
└── README.md                   # Project overview, features, and code structure.
```

## Building the Application

Refer to `Build.md` for detailed instructions on how to build the `jenkins-monitor` executable for various platforms.

## Installation and Deployment

Refer to `Install-instructions.md` for detailed instructions on how to install and deploy the `jenkins-monitor` application on a Linux system using `systemd`.
